(()=>{"use strict";function e(e){e.classList.add("hidden"),e.classList.remove("displayed")}function t(e){e.classList.add("displayed"),e.classList.remove("hidden")}class n{constructor(){this.recording=null,this.recorder=null,this.base64=null}record=async()=>{this.recorder=await new Promise((async e=>{const t=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaRecorder(t),o=[];n.addEventListener("dataavailable",(e=>{o.push(e.data)})),e({start:()=>n.start(),stop:()=>new Promise((e=>{n.addEventListener("stop",(()=>{const t=new Blob(o,{type:"audio/mpeg"}),n=URL.createObjectURL(t),i=new Audio(n);e({audioBlob:t,audioUrl:n,play:()=>i.play()})})),n.stop()}))})})),this.recorder.start()};stop=async()=>{this.recording=await this.recorder.stop(),this.base64=await async function(e){return new Promise(((t,n)=>{let o=new FileReader;o.onerror=n,o.onload=e=>t(e.target.result),o.readAsDataURL(e)}))}(this.recording.audioBlob)};play=async()=>{this.recording.play()}}function o(e){let t=document.createElement("audio");t.src=e,t.play()}class i{constructor(){this.wordDict={},this.recorder=new n,this.targetToNative=!0}static fromExistingJson(e){let t=new i;return t.sentenceOne=e.sentence_one,t.sentenceTwo=e.sentence_two,t.wordDict=e.word_dict,t.recorder.base64=e.audio_base64,t.targetToNative=e.target_to_native??!0,t}setSentenceOne(e){return this.sentenceOne=e,this}setSentenceTwo(e){return this.sentenceTwo=e,this}setDefinition(e,t){return this.wordDict[e]=t,this}record(){return this.recorder.record(),this}stopRecording(){return this.recorder.stop(),this}isEmpty(){return!(this.sentenceOne&&this.sentenceTwo)}playAudio(){o(this.recorder.base64)}invertTranslationDirection(){this.targetToNative=!this.targetToNative}toJson(){return{sentence_one:this.sentenceOne,sentence_two:this.sentenceTwo,word_dict:this.wordDict,audio_base64:this.recorder.base64,target_to_native:this.targetToNative}}}class s{constructor(){this.propositions=[new i],this.current=0}static fromExistingJson(e){let t=new s;return t.propositions=e.propositions.map((e=>i.fromExistingJson(e))),t.targetLanguage=e.target_language??"",t.sourceLanguage=e.source_language??"",t.author=e.author??"",t}getCurrent(){return this.propositions[this.current]}next(){this.propositions[this.current].sentenceOne&&this.propositions[this.current].sentenceTwo&&(this.current++,this.propositions[this.current]=this.propositions[this.current]??new i)}prev(){this.current=null==this.propositions[this.current-1]?this.current:this.current-1}toJson(){return{target_language:this.targetLanguage??"",source_language:this.sourceLanguage??"",author:this.author??"",last_modified:(new Date).getTime(),propositions:this.propositions.filter((e=>!e.isEmpty())).map((e=>e.toJson()))}}}function r(){let e=document.getElementById("input_sentence_one").value,t=document.getElementById("input_sentence_two").value;window.lessonBuilder.getCurrent().setSentenceOne(e).setSentenceTwo(t),window.lessonBuilder.getCurrent().wordDict=c()}function d(e){document.getElementById("input_sentence_one").value=e.sentenceOne??"",document.getElementById("input_sentence_two").value=e.sentenceTwo??"",function(e){u();for(let t of Object.entries(e))a(t[0],t[1])}(e.wordDict),document.getElementById("invert_translation_direction").checked=e.targetToNative}function l(e){r(),e?window.lessonBuilder.next():window.lessonBuilder.prev(),d(window.lessonBuilder.getCurrent())}function a(e,t){var n=document.getElementById("table_definitions").insertRow(),o=n.insertCell(0),i=n.insertCell(1);e=e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"),t=t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"),o.innerHTML=`<input  type='text' value="${e}">`,i.innerHTML=`<input  type='text' value="${t}">`}function u(){document.getElementById("table_definitions").innerHTML=""}function c(){var e={};for(let t of document.getElementById("table_definitions").rows)try{let n=t.cells[0].children[0].value,o=t.cells[1].children[0].value;e[n]=o}catch{}return e}window.lessonBuilder=new s,d(window.lessonBuilder.getCurrent()),document.getElementById("craft_lesson_input_existing_lesson").addEventListener("change",(function(){let e=new FileReader;e.onload=function(){window.lessonBuilder=s.fromExistingJson(JSON.parse(e.result)),d(window.lessonBuilder.getCurrent()),document.getElementById("button_play_audio").classList.add("displayed"),document.getElementById("input_metadata_target_lang").value=window.lessonBuilder.targetLanguage,document.getElementById("input_metadata_source_lang").value=window.lessonBuilder.sourceLanguage,document.getElementById("input_metadata_author").value=window.lessonBuilder.author},e.readAsText(this.files[0])})),document.getElementById("button_next").addEventListener("click",(function(){l(!0),console.log(window.lessonBuilder)})),document.getElementById("button_previous").addEventListener("click",(function(){l(!1)})),document.getElementById("button_audio").addEventListener("click",new function(){let e=!1;return function(){e?(window.lessonBuilder.getCurrent().stopRecording(),e=!1,document.getElementById("button_audio").value="Record Audio🎙️",document.getElementById("button_play_audio").classList.add("displayed")):(window.lessonBuilder.getCurrent().record(),e=!0,document.getElementById("button_audio").value="Stop Recording 🔴")}}),document.getElementById("input_sentence_one").addEventListener("input",(function(){window.lessonBuilder.getCurrent().wordDict=c(),u();for(let e of document.getElementById("input_sentence_one").value.split(/\s+/))a(e,window.lessonBuilder.getCurrent().wordDict[e]??"")})),document.getElementById("button_play_audio").addEventListener("click",(function(){window.lessonBuilder.getCurrent().playAudio()})),document.getElementById("button_save_to_computer").addEventListener("click",(function(){r(),console.log(window.lessonBuilder.toJson()),saveToComp(JSON.stringify(window.lessonBuilder.toJson()),"lesson","text/plain")})),document.getElementById("invert_translation_direction").addEventListener("change",(function(){window.lessonBuilder.getCurrent().invertTranslationDirection()})),document.getElementById("input_metadata_target_lang").addEventListener("input",(function(){window.lessonBuilder.targetLanguage=document.getElementById("input_metadata_target_lang").value})),document.getElementById("input_metadata_source_lang").addEventListener("input",(function(){window.lessonBuilder.sourceLanguage=document.getElementById("input_metadata_source_lang").value})),document.getElementById("input_metadata_author").addEventListener("input",(function(){window.lessonBuilder.author=document.getElementById("input_metadata_author").value}));class g{constructor(e){this.sentenceOne=e.sentence_one,this.sentenceTwo=e.sentence_two,this.audioBase64=e.audio_base64,this.wordDict=e.word_dict,this.targetToNative=e.target_to_native??!0}play(){o(this.audioBase64)}check(e){let t=this.targetToNative?this.sentenceTwo:this.sentenceOne,n=0;for(let o of e.split(/\s+/))t.split(/\s+/).includes(o)&&n++;return parseInt(100*n/this.sentenceTwo.split(/\s+/).length)}}class m{constructor(e){this.propositions=e.propositions.map((e=>new g(e))),this.targetLanguage=e.target_language??"",this.sourceLanguage=e.source_language??"",this.author=e.author??"",this.iterator=this.propositions.values(),this.next()}next(){this.current=this.iterator.next().value}getCurrent(){return this.current}}function _(n){let o=createElementFromHTML(`<p> ${n.sentenceTwo} </p>`),i=document.createElement("div");for(let e of n.sentenceOne.split(/\s+/)){let t=createElementFromHTML(`<span class="word">${e}</span> <span class="tool_tip">${n.wordDict[e]??""} </span>`);i.appendChild(t)}document.getElementById("div_problem").innerHTML="",document.getElementById("div_solution").innerHTML="",n.targetToNative?(document.getElementById("div_problem").appendChild(i),document.getElementById("div_solution").appendChild(o),t(document.getElementById("take_lesson_button_play_audio")),n.play()):(document.getElementById("div_problem").appendChild(o),document.getElementById("div_solution").appendChild(i),e(document.getElementById("take_lesson_button_play_audio")))}function p(){e(document.getElementById("div_take_lesson")),e(document.getElementById("div_craft_lesson")),e(document.getElementById("div_welcome"))}document.getElementById("input_lesson_file").addEventListener("change",(function(){let e=new FileReader;this.onclick=()=>{this.value=null},e.onload=function(){let n=new m(JSON.parse(e.result));console.log(n),function(e){t(document.getElementById("take_lesson_div_root")),window.lesson=e,_(e.getCurrent())}(n)},e.readAsText(this.files[0])})),document.getElementById("take_lesson_button_play_audio").addEventListener("click",(function(){window.lesson.getCurrent().play()})),document.getElementById("take_lesson_button_next").addEventListener("click",new function(){let n=!1;return function(){if(n)e(document.getElementById("div_solution")),document.getElementById("input_translation_answer").value="",document.getElementById("p_grading").innerHTML="",window.lesson.next(),_(window.lesson.getCurrent()),document.getElementById("take_lesson_button_next").value="See Solution";else{t(document.getElementById("div_solution"));let e=window.lesson.getCurrent().check(document.getElementById("input_translation_answer").value);document.getElementById("p_grading").innerHTML=`${e}%`,document.getElementById("take_lesson_button_next").value="Next",window.lesson.getCurrent().targetToNative||(t(document.getElementById("take_lesson_button_play_audio")),window.lesson.getCurrent().play())}n=!n}}),document.getElementById("button_craft_lesson").addEventListener("click",(function(){p(),t(document.getElementById("div_craft_lesson"))})),document.getElementById("button_take_lesson").addEventListener("click",(function(){p(),t(document.getElementById("div_take_lesson"))})),document.getElementById("button_welcome").addEventListener("click",(function(){p(),t(document.getElementById("div_welcome"))}))})();